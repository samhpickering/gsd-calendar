<!-- Design based on https://gumroad.com/l/getshitdone -->
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<title>GSD Calendar</title>
	<style type="text/css">
		:root {
			--box-size: 2.4em;
			--border-width: 1.5px;
			--border-style: var(--border-width) solid #000000;
			--border-radius: 0.4em;
			--between-weeks: 0.7em;
		}

		body {
			font-size: 9pt;
			font-family: Calibri, 'Trebuchet MS', sans-serif;
		}
		table, tr, td {
			box-sizing: border-box;
			border-spacing: 0px;
		}

		#header {
			width: 100%;
		}

		#titleHeader {
			padding-left: 1.5em;
			font-size: 40pt;
			vertical-align: middle;
		}
		#yearHeader {
			font-size: 48pt;
			font-weight: bold;
			text-align: right;
			vertical-align: middle;
			padding-right: 0.15em;
		}

		#monthLabels {
			margin-right: 0.5em;
			text-align: right;
		}
		#monthLabels td {
			width: 6em;
			height: var(--box-size);
			padding-bottom: var(--border-width);
		}

		.dayLabelTable td {
			text-align: center;
			width: var(--box-size);
			height: var(--box-size);
		}

		.weekTable {
			text-align: center;
			border-radius: var(--border-radius);
			border: var(--border-style);
			margin-right: var(--between-weeks);
		}
		.weekTable td {
			width: var(--box-size);
			height: var(--box-size);
		}
		.weekTable td {
			border-right: var(--border-style);
			border-bottom: var(--border-style);
		}
		.weekTable td:last-of-type {
			border-right: 0;
		}
		.weekTable tr:last-of-type td {
			border-bottom: 0;
		}

		.blankDay {
			background-color: black;
		}

		#controls {
			display: none;
		}
		#controls input {
			margin-bottom: 0.2em;
		}
	</style>
	<script lang="text/javascript">		
		var weekTables = [
			{id: "week1", labelsId: "labels1", length: 7, labels: [], rows: []},
			{id: "week2", labelsId: "labels2", length: 7, labels: [], rows: []},
			{id: "week3", labelsId: "labels3", length: 7, labels: [], rows: []},
			{id: "week4", labelsId: "labels4", length: 7, labels: [], rows: []},
			{id: "week5", labelsId: "labels5", length: 7, labels: [], rows: []},
			{id: "week6", labelsId: "labels6", length: 2, labels: [], rows: []}
		];
		var monthLabels = [];

		function buildWeekLabels() {
			for (var i = 0; i < weekTables.length; i++) {
				var week = weekTables[i];

				var labelTable = document.getElementById(week.labelsId);

				var row = document.createElement("tr");
				for (var j = 0; j < week.length; j++) {
					var label = document.createElement("td");
					row.appendChild(label);

					week.labels.push(label);
				}
				labelTable.appendChild(row);

				labelTable.className = "dayLabelTable";
			}
		}

		function resizeTables(rowCount) {
			for (var i = 0; i < weekTables.length; i++) {
				var week = weekTables[i];

				var weekTable = document.getElementById(week.id);

				if (week.rows.length < rowCount) {
					// If we've added more rows, create the rows/cells and add them to the table
					var newRows = rowCount - week.rows.length;
					for (var j = 0; j < newRows; j++) {
						var row = document.createElement("tr");
						for (var k = 0; k < week.length; k++) {
							var cell = document.createElement("td");
							cell.textContent = "1";
							row.appendChild(cell);
						}

						weekTable.appendChild(row);
						week.rows.push(row);
					}
 				} else if (week.rows.length > rowCount) {
					// If we've removed rows, remove them from the table
					for (var j = week.rows.length; j > rowCount; j--) {
					 	var row = week.rows.pop();
						weekTable.removeChild(row);
					}
				}
			}

			var monthLabelTable = document.getElementById("monthLabels");
			if (monthLabels.length < rowCount) {
				var newRows = rowCount - monthLabels.length;
				for (var i = 0; i < newRows; i++) {
					var row = document.createElement("tr");
					var cell = document.createElement("td");
					row.appendChild(cell);
					monthLabelTable.appendChild(row);

					monthLabels.push(row);
				}
			} else if (monthLabels.length > rowCount) {
				for (var i = monthLabels.length; i > rowCount; i--) {
					var row = monthLabels.pop();
					monthLabelTable.removeChild(row);
				}
			}
		}


		// Fill day numbers
		function fillTables(startDate, endDate, startWeekday) {
			var monthCount = ((endDate.getFullYear() - startDate.getFullYear()) * 12) + endDate.getMonth() - startDate.getMonth() + 1;
			monthCount = Math.max(monthCount, 1);
			resizeTables(monthCount);

			var startYear = startDate.getFullYear();
			for (var month = 0; month < monthCount; month++) {
				var rowMonth = startDate.getMonth() + month;
				var firstDate = new Date(startYear, rowMonth, 1);
				
				var firstWeekday = (firstDate.getDay() + 6) % 7; // 0 = Sun -> 0 = Mon
				var startOffset = (startWeekday - firstWeekday) + 1;
				if (startOffset > 1) startOffset = startOffset - 7;

				var curDay = new Date(startYear, rowMonth, startOffset);

				for (var i = 0; i < weekTables.length; i++) {
					var week = weekTables[i];
					var row = week.rows[month];
					for (var cell = 0; cell < row.children.length; cell++) {
						if (curDay.getMonth() != rowMonth % 12 || curDay < startDate || curDay > endDate) {
							row.children[cell].className = "blankDay";
							row.children[cell].textContent = "";
						} else {
							row.children[cell].className = "";
							row.children[cell].textContent = curDay.getDate();
						}

						curDay.setDate(curDay.getDate() + 1);
					}
				}

				monthLabels[month].children[0].textContent = firstDate.toLocaleDateString(undefined, { month: "long" }); //[(startDate.getMonth() + month) % 12];
			}

			var weekday = startWeekday;
			for (var i = 0; i < weekTables.length; i++) {
				var week = weekTables[i];

				for (var j = 0; j < week.labels.length; j++) {
					var monday = new Date(2021, 04, 10); // May 10th 2021
					monday.setDate(monday.getDate() + (weekday % 7));
					
					week.labels[j].textContent = monday.toLocaleDateString(undefined, { weekday: "short" });;
					weekday++;
				}
			}
		}
		
		function toggleControls() {
			var controlsEl = document.getElementById("controls");
			if (controlsEl.style.display == "block") {
				controlsEl.style.display = "none";
			} else {
				controlsEl.style.display = "block";
			}
		}

		// Seperate for live updates
		function updateTitle() {
			// Update title text
			var titleInputEl = document.getElementById("titleInput");
			var titleHeaderEl = document.getElementById("titleHeader");
			titleHeaderEl.textContent = titleInputEl.value;
		}
		function updateTable() {
			updateTitle();

			// Update start date - if empty, use current date
			var startDateInputEl = document.getElementById("startDateInput");
			if (isNaN(startDateInputEl.valueAsNumber)) {
				var now = new Date();
				startDateInputEl.valueAsNumber = now.getTime();
			}

			// Update end date - if empty, use one year away
			var endDateInputEl = document.getElementById("endDateInput");
			if (isNaN(endDateInputEl.valueAsNumber)) {
				var now = new Date();
				now.setFullYear(now.getFullYear() + 1);
				now.setDate(now.getDate() - 1);
				endDateInputEl.valueAsNumber = now.getTime();
			}

			var startDate = new Date(startDateInputEl.valueAsNumber);
			startDate.setHours(0, 0, 0, 0);

			var endDate = new Date(endDateInputEl.valueAsNumber);
			endDate.setHours(0, 0, 0, 0);
			
			// Update year text
			var yearHeaderEl = document.getElementById("yearHeader");
			if (startDate.getFullYear() == endDate.getFullYear()) {
				yearHeaderEl.textContent = startDate.getFullYear();
			} else if (Math.floor(endDate.getFullYear() / 100) == Math.floor(startDate.getFullYear() / 100)) {
				var startYear = String(startDate.getFullYear());
				var endYear = String(endDate.getFullYear());
				yearHeaderEl.textContent = startYear + "-" + endYear.substring(endYear.length - 2);
			} else {
				yearHeaderEl.textContent = String(startDate.getFullYear()) + "-" + String(endDate.getFullYear());
			}
			

			// Update start weekday
			var startWeekdayInputEl = document.getElementById("startWeekdayInput");
			startWeekday = parseInt(startWeekdayInputEl.value);

			fillTables(startDate, endDate, startWeekday);
		}
	</script>
</head>
<body onload="buildWeekLabels(); updateTable();">
	<table onclick="toggleControls()">
		<tr>
			<td>
				<table id="header">
					<tr>
						<td id="titleHeader"></td>
						<td id="yearHeader"></td>
					</tr>
				</table>
			</td>
		</tr>
		<tr>
			<td>
				<table id="container">
					<tr>
						<td></td>
						<td><table id="labels1"></table></td>
						<td><table id="labels2"></table></td>
						<td><table id="labels3"></table></td>
						<td><table id="labels4"></table></td>
						<td><table id="labels5"></table></td>
						<td><table id="labels6"></table></td>
					</tr>
					<tr>
						<td><table id="monthLabels"></table></td>
						<td><table id="week1" class="weekTable"></table></td>
						<td><table id="week2" class="weekTable"></table></td>
						<td><table id="week3" class="weekTable"></table></td>
						<td><table id="week4" class="weekTable"></table></td>
						<td><table id="week5" class="weekTable"></table></td>
						<td><table id="week6" class="weekTable"></table></td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
	<div id="controls">
		<h2>Controls</h2>
		Title: <input type="text" id="titleInput" value="Title - Click to show controls" oninput="updateTitle();" /><br />
		Start Date: <input type="date" id="startDateInput" onchange="updateTable();" /><br />
		End Date: <input type="date" id="endDateInput" onchange="updateTable();" /><br />
		Start Weekday: <select id="startWeekdayInput" value=0 onchange="updateTable();">
			<option value=0 selected="selected">Monday</option>
			<option value=1>Tuesday</option>
			<option value=2>Wednesday</option>
			<option value=3>Thursday</option>
			<option value=4>Friday</option>
			<option value=5>Saturday</option>
			<option value=6>Sunday</option>
		</select><br />
	</div>
</body>
</html>